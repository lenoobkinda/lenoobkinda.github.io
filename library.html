<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Media</title>
    <style>
        @keyframes flicker {
            0% { opacity: 0.27861 }
            5% { opacity: 0.34769 }
            10% { opacity: 0.23604 }
            15% { opacity: 0.90626 }
            20% { opacity: 0.18128 }
            25% { opacity: 0.83891 }
            30% { opacity: 0.65583 }
            35% { opacity: 0.67807 }
            40% { opacity: 0.26559 }
            45% { opacity: 0.84693 }
            50% { opacity: 0.96019 }
            55% { opacity: 0.08594 }
            60% { opacity: 0.20313 }
            65% { opacity: 0.71988 }
            70% { opacity: 0.53455 }
            75% { opacity: 0.37288 }
            80% { opacity: 0.71428 }
            85% { opacity: 0.70419 }
            90% { opacity: 0.7003 }
            95% { opacity: 0.36108 }
            100% { opacity: 0.24387 }
        }
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%), linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        .crt::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255,255,255,0.2);
            animation: scanline 14s infinite;
            z-index: 3;
            pointer-events: none;
        }
        @keyframes scanline { 0% { top: 0 } 85% { top: 100% } 100% { top: 100% } }
        @keyframes textShadow { 0% { text-shadow: 0.5px 0 rgba(0,30,255,0.5), -0.5px 0 rgba(255,0,80,0.3), 0 0 3px } 50% { text-shadow: 2px 0 rgba(0,30,255,0.5), -2px 0 rgba(255,0,80,0.3), 0 0 3px } 100% { text-shadow: 0.5px 0 rgba(0,30,255,0.5), -0.5px 0 rgba(255,0,80,0.3), 0 0 3px } }
        @keyframes slideIn { from { transform: translate(100vw,100vh) } to { transform: translate(-0.2,-0.2) } }
        .animated-box { position: absolute; bottom: 0; right: 20px; width: 100px; height: 100px; background-color: blue; animation: slideIn 1s ease-in-out forwards }
        .crt { animation: textShadow 1.6s infinite; position: relative; overflow: hidden }
        a { color: white }
        p { color: white }
        h1 { color: white }
        body { font-family: Arial, sans-serif; text-align: center; background-color: rgb(17,17,17); padding: 20px }
        .preview { margin: 10px; display: inline-block; text-align: left }
        .preview img, video { max-width: 300px; max-height: 200px; border: 1px solid rgb(40,40,40) }
        #custom--music-player { position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 8px; color: white; width: 300px; box-shadow: 0 0 10px rgba(0,0,0,0.5) }
    </style>
</head>
<body id="te" class="crt">
    <h1>Media</h1>
    <form id="filter-form">
        <label for="filter">Choose media type:</label>
        <select name="filter" id="filter">
            <option value="all">All</option>
            <option value="images">Images</option>
            <option value="videos">Videos</option>
        </select>
        <input type="submit" value="Filter">
    </form>
    <div id="media-list"></div>
    <div id="custom--music-player">
        <h4 style="margin:0;font-size:14px;text-align:center">Now Playing:</h4>
        <p id="song-name" style="margin:5px 0;font-size:12px;text-align:center">No songs available</p>
        <div style="display:flex;flex-direction:column;align-items:center">
            <div style="display:flex;justify-content:space-around;align-items:center;width:100%">
                <button id="play-pause" style="background:none;border:none;color:white;font-size:16px;cursor:pointer">▶️</button>
                <button id="next-song" style="background:none;border:none;color:white;font-size:16px;cursor:pointer">⏭️</button>
            </div>
            <div style="margin-top:10px;display:flex;align-items:center;width:100%">
                <label for="volume-slider" style="color:white;font-size:12px;margin-right:10px">Volume:</label>
                <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="1" style="width:80%">
            </div>
        </div>
        <audio id="audio-player" style="display:none"></audio>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', async function(){
    const mediaDir = 'media';
    const mediaListEl = document.getElementById('media-list');
    const audioPlayer = document.getElementById('audio-player');
    const songName = document.getElementById('song-name');
    const playPauseButton = document.getElementById('play-pause');
    const nextSongButton = document.getElementById('next-song');
    const volumeSlider = document.getElementById('volume-slider');
    const filterForm = document.getElementById('filter-form');
    volumeSlider.addEventListener('input', function(){ audioPlayer.volume = volumeSlider.value });

    function createAnimatedImage(){ if(document.getElementById('animated-img')) return; const img=document.createElement('img'); img.src='https://chud.love/chris.png'; img.style.position='fixed'; img.style.right='-175px'; img.style.bottom='10px'; img.style.width='100px'; img.style.height='200px'; img.style.transition='right 1s ease-in-out'; img.id='animated-img'; document.body.appendChild(img); setTimeout(()=>{ img.style.right='2px' },100) }
    function removeAnimatedImage(){ const e=document.getElementById('animated-img'); if(e) e.remove() }

    function togglePlayPause(){ if(!audioPlayer.src) return; if(audioPlayer.paused){ audioPlayer.play(); playPauseButton.textContent='⏸️'; if(songName.textContent==='Little Girls - Izaiah.mp3') createAnimatedImage() } else { audioPlayer.pause(); playPauseButton.textContent='▶️' } }
    playPauseButton.addEventListener('click', togglePlayPause);

    nextSongButton.addEventListener('click', ()=>{ if(!window.songs || window.songs.length===0) return; window.currentIndex = (window.currentIndex+1)%window.songs.length; window.updateSongInfo(); audioPlayer.play(); playPauseButton.textContent='⏸️'; if(songName.textContent==='Little Girls - Izaiah.mp3') createAnimatedImage(); });
    audioPlayer.addEventListener('ended', function(){ removeAnimatedImage(); if(window.songs && window.songs.length) { window.currentIndex = (window.currentIndex+1)%window.songs.length; window.updateSongInfo(); window.playing && audioPlayer.play(); } });

    const mediaExtensions = { images: ['jpg','jpeg','png','gif','webp','svg'], videos: ['mp4','mov','webm','mkv','avi'], audio: ['mp3','wav','ogg','m4a'] };
    function extOf(name){ const p = name.lastIndexOf('.'); return p>-1? name.slice(p+1).toLowerCase():'' }

    function makePlaceholder(file){
        const wrapper=document.createElement('div');
        wrapper.className='preview';
        wrapper.dataset.src = file.url;
        wrapper.dataset.name = file.name;
        const ph=document.createElement('div');
        ph.style.width='300px'; ph.style.height='200px'; ph.style.background='linear-gradient(90deg, #111, #222)'; ph.style.display='flex'; ph.style.alignItems='center'; ph.style.justifyContent='center'; ph.style.color='#888'; ph.textContent = file.name;
        wrapper.appendChild(ph);
        return wrapper;
    }

    const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
            if (!entry.isIntersecting) return;
            const el = entry.target;
            const src = el.dataset.src;
            const name = el.dataset.name;
            const e = extOf(name);
            el.innerHTML = '';
            if (mediaExtensions.images.includes(e)){
                const img = document.createElement('img'); img.src = src; img.alt = name; el.appendChild(img);
            } else if (mediaExtensions.videos.includes(e)){
                const vid = document.createElement('video'); vid.controls = true; vid.width = 300; const s = document.createElement('source'); s.src = src; s.type = 'video/mp4'; vid.appendChild(s); el.appendChild(vid);
            } else if (mediaExtensions.audio.includes(e)){
                const a = document.createElement('audio'); a.controls = true; a.src = src; el.appendChild(a);
            } else {
                const link = document.createElement('a'); link.href = src; link.textContent = name; link.target = '_blank'; el.appendChild(link);
            }
            obs.unobserve(el);
        })
    }, {rootMargin:'400px'});

    // discovery: try GitHub Contents API (auto-detect repo), then manifest.json fallback
    async function listMediaFromGitHub(){
        let owner, repo;
        const host = location.hostname;
        if (host.endsWith('github.io')){
            owner = host.split('.')[0];
            const parts = location.pathname.split('/').filter(Boolean);
            if (parts.length>0) repo = parts[0];
            else repo = owner + '.github.io';
        } else {
            const match = new URLSearchParams(location.search).get('gh');
            if (match && match.includes('/')) [owner, repo] = match.split('/');
        }
        if (!owner || !repo) return [];
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${mediaDir}`;
        try{
            const res = await fetch(apiUrl);
            if (!res.ok) return [];
            const items = await res.json();
            return items.filter(i => i.type==='file' && i.download_url).map(i=>({name:i.name,url:i.download_url}));
        }catch(e){ return [] }
    }

    async function loadManifestFallback(){
        try{
            const r = await fetch(mediaDir + '/manifest.json');
            if (!r.ok) return [];
            const data = await r.json();
            // manifest may be either {files:[{name,url,type}]} or {images:[],videos:[],audio:[]}
            if (Array.isArray(data.files)) return data.files.map(f=>({name:f.name,url:f.url|| (mediaDir + '/' + f.name)}));
            const list = [];
            ['images','videos','audio'].forEach(k=>{ if (Array.isArray(data[k])) data[k].forEach(n=> list.push({name:n,url:mediaDir + '/' + n})) });
            return list;
        }catch(e){return []}
    }

    async function discoverFiles(){
        let files = await listMediaFromGitHub();
        if (files && files.length) return files;
        files = await loadManifestFallback();
        return files;
    }

    const files = await discoverFiles();
    if (!files.length){
        mediaListEl.textContent = 'No media discovered. If using GitHub Pages add files to the "' + mediaDir + '" folder or provide a manifest.json. You can also pass ?gh=owner/repo in the URL.';
    } else {
        files.sort((a,b)=> a.name.localeCompare(b.name));
        files.forEach(f=>{
            const p = makePlaceholder(f);
            mediaListEl.appendChild(p);
            observer.observe(p);
        });
        window.songs = files.filter(f=> mediaExtensions.audio.includes(extOf(f.name))).map(f=>f.url);
        window.currentIndex = 0;
        window.updateSongInfo = function(){ if (window.songs && window.songs.length){ audioPlayer.src = window.songs[window.currentIndex]; songName.textContent = window.songs[window.currentIndex].split('/').pop(); } else { audioPlayer.removeAttribute('src'); songName.textContent='No songs available' } };
        window.updateSongInfo();
    }

    filterForm.addEventListener('submit', function(e){ e.preventDefault(); const f = document.getElementById('filter').value; Array.from(mediaListEl.children).forEach(ch=>{ const name = ch.dataset.name || ''; const eext = extOf(name); if (f==='all') ch.style.display='inline-block'; else if (f==='images') ch.style.display = (mediaExtensions.images.includes(eext)) ? 'inline-block' : 'none'; else if (f==='videos') ch.style.display = (mediaExtensions.videos.includes(eext)) ? 'inline-block' : 'none'; }); });
});
    </script>
</body>
</html>
